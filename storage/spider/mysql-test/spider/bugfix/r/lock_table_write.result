for master_1
for child2
child2_1
child2_2
child2_3
for child3

this test is for MDEV-18973

drop and create databases
connection master_1;
CREATE DATABASE auto_test_local;
USE auto_test_local;
connection child2_1;
SET @old_log_output = @@global.log_output;
SET GLOBAL log_output = 'TABLE,FILE';
CREATE DATABASE auto_test_remote;
USE auto_test_remote;

create table and insert
connection child2_1;
CHILD2_1_CREATE_TABLES
TRUNCATE TABLE mysql.general_log;
connection master_1;
CREATE TABLE tbl_a (
id int NOT NULL,
id2 int NOT NULL,
id3 int NOT NULL,
dummy1 char(30),
primary key (id,id2),
index index_id3 (id3)
) MASTER_1_ENGINE MASTER_1_CHARSET MASTER_1_COMMENT_2_1

select test 1
connection child2_1;
TRUNCATE TABLE mysql.general_log;
connection master_1;
INSERT INTO tbl_a VALUES (0,0,0,'ABCDEFGHIJ'),(2,2,2,'BCDEFGHIJK'),(1,1,1,'CDEFGHIJKL');
LOCK TABLES tbl_a WRITE;
INSERT INTO tbl_a VALUES (99,1,2,'D'),(1,1,2,'D');
ERROR 23000: Duplicate entry '1-1' for key 'PRIMARY'
SELECT id FROM tbl_a ORDER BY id;
id
0
1
2
UNLOCK TABLES;
connection child2_1;
SELECT argument FROM mysql.general_log WHERE argument LIKE '%lock %';
argument
lock tables `auto_test_remote`.`tbl_a` write
unlock tables
SELECT argument FROM mysql.general_log WHERE argument LIKE '%lock %'
SELECT id, id2, id3, dummy1 FROM tbl_a ORDER BY id;
id	id2	id3	dummy1
0	0	0	ABCDEFGHIJ
1	1	1	CDEFGHIJKL
2	2	2	BCDEFGHIJK

deinit
connection master_1;
DROP DATABASE IF EXISTS auto_test_local;
connection child2_1;
DROP DATABASE IF EXISTS auto_test_remote;
SET GLOBAL log_output = @old_log_output;
for master_1
for child2
child2_1
child2_2
child2_3
for child3

end of test
